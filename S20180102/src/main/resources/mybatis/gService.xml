<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="GServDto">
  <!-- Use type aliases to avoid typing the full classname every time. -->
  <resultMap id="GServDtoResult" type="GServDto">
    <result property="gNo" column="gNo"/>
    <result property="gServNo" column="gServNo"/>
    <result property="gServTitle" column="gServTitle"/>
    <result property="gServGps" column="gServGps"/>
    <result property="gServLeadTime" column="gServLeadTime"/>
    <result property="gServSub" column="gServSub"/>
    <result property="gServArea" column="gServArea"/>
    <result property="memSizeMin" column="memSizeMin"/>
    <result property="memSizeMax" column="memSizeMax"/>
    <result property="gServLang" column="gServLang"/>
    <result property="pickUpLoc" column="pickUpLoc"/>
    <result property="pickUpTime" column="pickUpTime"/>
    <result property="pInclude" column="pInclude"/>
    <result property="notPInclude" column="notPInclude"/>
    <result property="caution" column="caution"/>
    <result property="gServSDate" column="gServSDate"/>
    <result property="gServEDate" column="gServEDate"/>
    <result property="gServDay" column="gServDay"/>
    <result property="gServCreDate" column="gServCreDate"/>
    <result property="gServFixDate" column="gServFixDate"/>
    <result property="gServLock" column="gServLock"/>
  </resultMap>
  
  <!-- 지영 -->
  <resultMap id="tcResult" type="TourCardDto">
		<result property="rn" column="rn" />
		<result property="imgSrc" column="imgSrc" />
		<result property="gImg" column="gImg" />
		<result property="nickName" column="nickName" />
		<result property="gServTitle" column="gServTitle" />
		<result property="gServSub" column="gServSub" />
		<result property="gServLeadTime" column="gServLeadTime" />
		<result property="likeIt" column="likeIt" />
		<result property="remainSize" column="remainSize" />
		<result property="gServNo" column="gServNo" />
		<result property="gServPrice" column="gServPrice" />
		<result property="heart" column="heart" />
	</resultMap>
  
  
  
  
  <select id="oneTourCard" parameterType="ReservDto" resultMap="tcResult">
  	 Select sv.gno, sv.gservno, sv.gServtitle, cs.itemname gServSub, sv.gServPrice, Decode(lt.gServNo,sv.gServNo,'1','0') heart,
			            sv.gServLeadtime, lk.cnt likeit, ct.imgSrc, gd.gImg, mb.nickname, (sv.memsizemax-NVL(rv.cnt,0)) remainSize
			     From     gService sv 
			          ,   codeset  cs
			          ,   contents ct
			          ,   guide    gd
			          ,   member   mb
			          , ( select distinct gServNo from likeit
			           ) le
			          , ( select gServNo from likeit where memberID = '${memberId}'
			              group by gServNo 
			           ) lt
			          , ( select gServno, count(*) cnt from likeit
			              group by gServno
			           ) lk
			          , ( select gServno, count(*) cnt from reservation 
			               group by gServno
			           ) rv 
			      Where  sv.gServsub = cs.itemcode(+)
			       and   sv.gServno  = lk.gServno(+) 
			       and   sv.gServno = ct.gServno(+)
			       and   sv.gServNo = lt.gServNO(+)
			       and   cs.DIVCODE = '02'
			       and   ct.GSERVORDER = '1'
			       and   sv.gno = gd.gno(+)
			       and   sv.gServNo = le.gServNo(+)
			       and   sv.gServno = rv.gServno(+)
			       and   mb.memberId = gd.memberId
			       and   sv.gServno = ${gServNo}
  </select>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- 태욱 -->
  
   <select id="listAll" parameterType="GServDto" resultMap="GServDtoResult">
      select * from (select rownum rn, a.* from (select * from gService
    	 order by gServno) a) where rn between #{start} and
    	 #{end} <if test="gNo!=null">and gno in #{gNo}</if>   	
   </select>
    <select id="total" resultType="int">
  	select count(*) from gService
   </select>
   <select id="gNoServTotal" parameterType="int" resultType="int">
  	select count(*) from gService where gServNo=#{gServNo}
   </select>
   
   <select id="oneGServ" parameterType="int" resultType="gServDto">
  		select c1.itemName Subname,
			case 
			when c2.itemcode like '01%' and c2.itemcode!='0100' then '서울시 '
			when c2.itemcode like '02%' and c2.itemcode!='0200' then '부산시 '
			when c2.itemcode like '03%' and c2.itemcode!='0300' then '인천시 '
			when c2.itemcode like '04%' and c2.itemcode!='0400' then '대구시 '
			when c2.itemcode like '05%' and c2.itemcode!='0500' then '대전시 '
			when c2.itemcode like '06%' and c2.itemcode!='0600' then '광주시 '
			when c2.itemcode like '07%' and c2.itemcode!='0700' then '울산시 '
			when c2.itemcode like '08%' and c2.itemcode!='0800' then '강원도 '
			when c2.itemcode like '09%' and c2.itemcode!='0900' then '경기도 '
			when c2.itemcode like '10%' and c2.itemcode!='1000' then '충청북도 '
			when c2.itemcode like '11%' and c2.itemcode!='1100' then '충청남도 '
			when c2.itemcode like '12%' and c2.itemcode!='1200' then '경상북도 '
			when c2.itemcode like '13%' and c2.itemcode!='1300' then '경상남도 '
			when c2.itemcode like '14%' and c2.itemcode!='1400' then '전라북도 '
			when c2.itemcode like '15%' and c2.itemcode!='1500' then '전라남도 '
			when c2.itemcode like '16%' and c2.itemcode!='1600' then '제주도 '
			else ''
			end||c2.itemName AreaName, g.*
			from Gservice g, codeSet c1, codeSet c2
			where  (g.gServSub = c1.itemcode and c1.divcode=02)
			and    (g.gServArea = c2.itemcode and c2.divcode=01) and gServNo=#{gServNo}
   </select>
   
  <!--  <select id="selectManager"  resultMap="EmpResult"> -->
   <!-- <select id="selectManager"  resultType="Emp">
      select * from emp where empno  in (select mgr from emp)
   </select>
   
   <select id="detail" parameterType="int" resultType="Emp">
   	 select * from emp  where empno = #{empno}
   </select>
   
    <update id="update" parameterType="Emp">
	 update emp set ename=#{ename},job=#{job},mgr=#{mgr},
	    <if test="hiredate!=''">hiredate=#{hiredate},</if>
	    sal=#{sal}, 
	    <if test="comm!=null"> 	comm=#{comm},    </if>
	    deptno=#{deptno} where empno=#{empno}
   </update>
   
   <insert id="insert" parameterType="Emp">
	 insert into emp values (#{empno},#{ename},#{job},#{mgr},
	    #{hiredate},#{sal},#{comm},#{deptno} ) 
  </insert>
  
   <insert id="insert2" parameterType="Crawling">
	 insert into tbl_Crawling values (CRAWL_SEQ.nextval,#{url},#{title},#{content}, sysdate ) 
  </insert>
  
   
  <delete id="delete" parameterType="int">
    delete from emp where empno=#{empno}
  </delete>  -->
</mapper>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="WishDto">
	<!-- Use type aliases to avoid typing the full classname every time. -->
	<resultMap id="tcResult" type="TourCardDto">
		<result property="rn" column="rn" />
		<result property="imgSrc" column="imgSrc" />
		<result property="gImg" column="gImg" />
		<result property="nickName" column="nickName" />
		<result property="gServTitle" column="gServTitle" />
		<result property="gServSub" column="gServSub" />
		<result property="gServLeadTime" column="gServLeadTime" />
		<result property="likeIt" column="likeIt" />
		<result property="remainSize" column="remainSize" />
		<result property="gServNo" column="gServNo" />
		<result property="gServPrice" column="gServPrice" />
	</resultMap>


	<select id="selWishList" parameterType="PagingDto" resultMap="tcResult">
		select * from 
			  (  Select rownum rn, sv.gservno, sv.gServtitle, cs.itemname gServSub, sv.gServLeadtime, sv.gServPrice, lk.cnt likeIt, ct.imgSrc, gd.gImg, mb.nickname, (sv.memsizemax-NVL(rv.cnt,0)) remainSize
			     From     gService sv 
			          ,   codeset  cs
			          ,   contents ct
			          ,   guide    gd
			          ,   member   mb
			          , ( select gServno, count(*) cnt from likeit
			              group by gServno
			           ) lk
			           , ( select gServno, count(*) cnt from reservation 
			               group by gServno
			           ) rv 
			      Where  sv.gServsub = cs.itemcode(+)
			       and   sv.gServno  = lk.gServno(+) 
			       and   sv.gServno = ct.gServno(+)
			       and   cs.DIVCODE = '02'
			       and   ct.GSERVORDER = '1'
			       and   sv.gno = gd.gno(+)
			       and   sv.gServno = rv.gServno(+)
			       and   mb.memberId = gd.memberId
			       and   sv.gServno in (select gServno from wishlist where memberId='${memberId}')
   				)    
	   where rn between ${start} and ${end}   
	</select>
   
   <select id="totalWish" parameterType="java.lang.String" resultType="int">
   		select count(*) from wishList where memberId='${value}'
   </select>

	<delete id="delWishList" parameterType="WishDto">
		delete wishList where memberId='${memberId}'and gServNo = ${gServNo}
	</delete>
	
</mapper>